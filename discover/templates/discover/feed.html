{% extends 'base.html' %}
{% block title %}Discover{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto p-4">
  <h2 class="text-3xl font-bold mb-6 text-blue-700">Discover</h2>

  <!-- Filter Bar -->
  <form method="get" class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8 bg-white p-4 rounded-lg shadow-md">
    <div>
      <label for="state" class="block text-sm font-semibold text-gray-700">State</label>
      <select name="state" id="state"
        hx-get="/locations/load-cities/"
        hx-target="#city"
        hx-trigger="change"
        class="w-full border p-2 rounded bg-blue-50">
        <option value="">All States</option>
        {% for state in states %}
          <option value="{{ state.id }}" {% if state.id|stringformat:"s" == selected_state %}selected{% endif %}>
            {{ state.name }}
          </option>
        {% endfor %}
      </select>
    </div>

    <div>
      <label for="city" class="block text-sm font-semibold text-gray-700">City</label>
      <select name="city" id="city" class="w-full border p-2 rounded bg-blue-50">
        <option value="">All Cities</option>
        {% for city in cities %}
          <option value="{{ city.id }}" {% if city.id|stringformat:"s" == selected_city %}selected{% endif %}>
            {{ city.name }}
          </option>
        {% endfor %}
      </select>
    </div>

    <div>
      <label for="skill_type" class="block text-sm font-semibold text-gray-700">Skill Type</label>
      <select name="skill_type" id="skill_type" class="w-full border p-2 rounded bg-blue-50">
        <option value="">All</option>
        <option value="offered" {% if selected_type == 'offered' %}selected{% endif %}>Offered</option>
        <option value="requested" {% if selected_type == 'requested' %}selected{% endif %}>Requested</option>
      </select>
    </div>

    <div>
      <label for="search" class="block text-sm font-semibold text-gray-700">Search</label>
      <input type="text" name="search" id="search" value="{{ search_query }}" placeholder="Title or description"
             class="w-full border p-2 rounded bg-blue-50">
    </div>

    <div class="md:col-span-4 text-right">
      <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
        Apply Filters
      </button>
    </div>
  </form>

  <!-- Feed -->
  <div class="grid gap-4">
    {% for post in posts %}
      <div class="bg-white p-4 rounded-lg shadow">
        <h3 class="text-xl font-semibold text-gray-800">{{ post.title }}</h3>
        <p class="text-sm text-gray-600 mt-1">{{ post.description|truncatechars:150 }}</p>
        <div class="text-xs text-gray-400 mt-2">
          {{ post.created_at|date:"M d, Y" }} â€¢
          {{ post.user.community_profile.city.name }}
          {{ post.user.community_profile.state.abbreviation }}
        </div>
      </div>
    {% empty %}
      <p class="text-gray-500 text-center">No public posts found with those filters.</p>
    {% endfor %}
  </div>
</div>
{% endblock %}
